{% extends 'record/base.html' %}

{% block title %}Update Attendance Record{% endblock %}

{% block content %}
<h2>Update Attendance Record</h2>

<form method="POST" enctype="multipart/form-data" id="signatureForm">
    {% csrf_token %}
    <!-- First Name Field -->
    <div class="mb-3">
        <label for="{{ form.fname.id_for_label }}" class="form-label">First Name</label>
        <input type="text" class="form-control" id="{{ form.fname.id_for_label }}" name="{{ form.fname.name }}" value="{{ form.fname.value|default_if_none:'' }}" aria-describedby="{{ form.fname.id_for_label }}-help">
    </div>

    <!-- Last Name Field -->
    <div class="mb-3">
        <label for="{{ form.lname.id_for_label }}" class="form-label">Last Name</label>
        <input type="text" class="form-control" id="{{ form.lname.id_for_label }}" name="{{ form.lname.name }}" value="{{ form.lname.value|default_if_none:'' }}" aria-describedby="{{ form.lname.id_for_label }}-help">
    </div>

    <!-- Other Names Field -->
    <div class="mb-3">
        <label for="{{ form.onames.id_for_label }}" class="form-label">Other Names</label>
        <input type="text" class="form-control" id="{{ form.onames.id_for_label }}" name="{{ form.onames.name }}" value="{{ form.onames.value|default_if_none:'' }}" aria-describedby="{{ form.onames.id_for_label }}-help">
    </div>

    <!-- Station Dropdown -->
    <div class="mb-3">
        <label for="{{ form.station.id_for_label }}" class="form-label">Select the station</label>
        <select id="{{ form.station.id_for_label }}" class="form-select" name="{{ form.station.name }}">
            {% for choice in form.station.field.choices %}
                <option value="{{ choice.0 }}" {% if choice.0 == form.station.value %} selected {% endif %}>{{ choice.1 }}</option>
            {% endfor %}
        </select>
    </div>

    <!-- Signature Pad -->
    <div class="mb-3">
        <label for="signature-pad" class="form-label"><b>Signature</b></label>
    </div>
    <div class="mb-3">
        <canvas id="signature-pad" width="400" height="200" style="border: 2px solid green;"></canvas>
    </div>

    <button type="button" id="clear" class="btn btn-danger">Clear</button>
    <br><br>
    <button type="submit" class="btn btn-primary">Submit</button>

    <!-- Hidden field for the signature data -->
    <input type="hidden" name="signature" id="signatureInput">
</form>

{% endblock %}

{% block extra_scripts %}
    <!-- Correct CDN for SignaturePad -->
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var canvas = document.getElementById('signature-pad');
            var clearButton = document.getElementById('clear');
            var signatureForm = document.getElementById('signatureForm');
            var signatureInput = document.getElementById('signatureInput');
            var signaturePad = new SignaturePad(canvas);

            clearButton.addEventListener('click', function() {
                signaturePad.clear();
            });

            signatureForm.addEventListener('submit', function(event) {
                if (!signaturePad.isEmpty()) {
                    signatureInput.value = signaturePad.toDataURL();
                } else {
                    alert('Please provide a signature.');
                    event.preventDefault();
                }
            });
        });
    </script>
{% endblock %}
